import { CreateEmbeddingRequest, CreateEmbeddingRequestInput } from 'openai';
const tiktoken = require('tiktoken-node');
import { Activities } from '../../types/db-schema-definitions';
import { insertActivityEmbedding } from '../dal/activities';
import { ActivityEmbedding } from '../../types/types';
import { generateEmbeddings } from './open-ai';

const CHUNK_LIMIT = 8000;
const CHUNK_MINIMAL = 20;

const chunkReview = (review): Omit<ActivityEmbedding, 'activity_id'>[] => {
  const encoder = tiktoken.getEncoding('cl100k_base');
  let articleTextChunks: string[] = [];

  if (encoder.encode(review).length > CHUNK_LIMIT) {
    const split = review.split('. ');
    let chunkText = '';

    for (let i = 0; i < split.length; i++) {
      const sentence = split[i];
      const sentenceTokenLength = encoder.encode(sentence);
      const chunkTextTokenLength = encoder.encode(chunkText).length;

      if (chunkTextTokenLength + sentenceTokenLength.length > CHUNK_LIMIT) {
        articleTextChunks.push(chunkText);
        chunkText = '';
      }

      if (sentence[sentence.length - 1].match(/[a-z0-9]/i)) {
        chunkText += sentence + '. ';
      } else {
        chunkText += sentence + ' ';
      }
    }

    articleTextChunks.push(chunkText.trim());
  } else {
    articleTextChunks.push(review.trim());
  }

  const articleChunks = articleTextChunks.map(text => {
    const trimmedText = text.trim();

    const chunk = {
      content: trimmedText,
      content_length: trimmedText.length,
      content_tokens: encoder.encode(trimmedText).length,
      embedding: [],
    };

    return chunk;
  });

  if (articleChunks.length > 1) {
    for (let i = 0; i < articleChunks.length; i++) {
      const chunk = articleChunks[i];
      const prevChunk = articleChunks[i - 1];

      if (chunk.content_tokens < CHUNK_MINIMAL && prevChunk) {
        prevChunk.content += ' ' + chunk.content;
        prevChunk.content_length += chunk.content_length;
        prevChunk.content_tokens += chunk.content_tokens;
        articleChunks.splice(i, 1);
        i--;
      }
    }
  }

  const chunkedSection = [...articleChunks];

  return chunkedSection;
};

export const embedActivities = async (activity: Pick<Activities, 'id' | 'description'>) => {
  const chunkedReviews = chunkReview(activity.description);

  for (let i = 0; i < chunkedReviews.length; i++) {
    const embedding = [
      -0.01047527,
      0.000732961,
      -0.0032842127,
      -0.033553705,
      -0.018104222,
      0.03467581,
      -0.021949489,
      0.017433695,
      0.004987898,
      -0.011857376,
      -0.007498952,
      -0.004505529,
      -0.017228432,
      -0.007964216,
      -0.006978952,
      -0.026998965,
      0.016626326,
      -0.019157907,
      -0.0046389503,
      -0.03174739,
      -0.013116324,
      -0.0046423716,
      0.024590543,
      -0.037412655,
      0.0077657946,
      -0.020156855,
      0.014546325,
      -0.009695269,
      -0.012315798,
      -0.0047655297,
      0.010167375,
      0.0050563193,
      -0.0057576355,
      -0.016421063,
      -0.0026119754,
      -0.024152648,
      0.012172113,
      0.015901063,
      0.0004725332,
      -0.008231058,
      0.0053915824,
      0.004498687,
      -0.00025978635,
      -0.026862122,
      -0.005785004,
      0.013821062,
      -0.02033475,
      0.009483164,
      -0.017529486,
      0.010577901,
      0.013088956,
      0.005921846,
      -0.008532111,
      0.007950531,
      -0.0023194752,
      -0.020115802,
      -0.010167375,
      0.008456848,
      0.013403693,
      -0.014902115,
      -0.010256322,
      -0.034210548,
      -0.02649265,
      -0.00007435449,
      -0.00029506598,
      -0.006773689,
      -0.020389488,
      0.01131685,
      -0.006541057,
      0.0067155305,
      0.016872643,
      0.025562122,
      -0.014861062,
      0.0010143428,
      0.041107394,
      -0.013540535,
      -0.016858958,
      -0.0032021073,
      0.01692738,
      0.010030533,
      0.005925267,
      -0.017365275,
      -0.0037905287,
      0.0052889506,
      0.0056857932,
      0.011077376,
      0.009722638,
      0.043515816,
      0.00029442454,
      -0.005528425,
      0.0148200095,
      0.022045277,
      0.004235266,
      0.0016557906,
      0.010092112,
      0.0030567124,
      0.0024409227,
      0.014737904,
      -0.017912643,
      0.008320006,
      0.011097902,
      -0.009387375,
      0.00090401375,
      -0.017488433,
      -0.026383175,
      -0.008326848,
      0.011802639,
      -0.0042147394,
      0.017461063,
      0.025356859,
      0.01122106,
      0.017638959,
      -0.0053265826,
      -0.01676317,
      -0.009428428,
      0.0006457241,
      0.00859369,
      0.001118685,
      0.022825278,
      0.0022510542,
      0.016188432,
      0.013916851,
      0.025096858,
      0.011604218,
      0.010790007,
      0.016941063,
      -0.007471584,
      -0.034511603,
      -0.033061076,
      -0.01728317,
      0.005624214,
      0.022811593,
      0.002512765,
      0.0065205307,
      -0.0162158,
      0.0064760568,
      -0.013957904,
      0.031254757,
      -0.027724229,
      -0.0051247403,
      0.010543691,
      0.01196685,
      -0.0012478298,
      -0.033088442,
      0.022401066,
      0.02639686,
      0.022620015,
      0.01877475,
      0.018076854,
      0.00060167804,
      0.03683792,
      -0.02646528,
      -0.0011229613,
      0.0016429616,
      0.011761587,
      -0.004912635,
      0.004861319,
      0.02805265,
      -0.00044901346,
      -0.0077589527,
      -0.014026325,
      -0.01368422,
      -0.0027847388,
      -0.019773697,
      0.0053402665,
      0.027464228,
      0.025206333,
      0.03245897,
      0.01332843,
      -0.009955269,
      -0.009681585,
      -0.00007574429,
      -0.03716634,
      0.017474748,
      0.016010538,
      0.03484002,
      -0.018063169,
      -0.012904219,
      0.008874216,
      -0.004177108,
      -0.0036947392,
      -0.004307108,
      0.023482122,
      0.018063169,
      -0.012664746,
      0.01657159,
      0.033061076,
      0.013109482,
      0.022975804,
      -0.009024743,
      0.00053881615,
      0.009476322,
      0.018200012,
      -0.00036883247,
      -0.6568425,
      0.0026684229,
      -0.018377908,
      -0.039656866,
      0.008504743,
      0.0025794753,
      0.008121585,
      0.0058260565,
      0.0037050024,
      -0.013082114,
      -0.0083679,
      0.006411057,
      0.00081506633,
      0.014806326,
      -0.0036571077,
      -0.027847387,
      0.0041463184,
      -0.0058363196,
      0.010598428,
      0.012411587,
      -0.009982638,
      0.023755806,
      0.027683176,
      0.020033697,
      0.023140015,
      0.006229741,
      0.00243237,
      -0.0298316,
      -0.040587395,
      0.009161585,
      -0.01971896,
      -0.0035921077,
      -0.005863688,
      -0.0038897395,
      0.040915817,
      -0.013431061,
      -0.024658963,
      0.024344226,
      0.004786056,
      0.058349513,
      0.0029831599,
      -0.006965268,
      0.03418318,
      -0.011378429,
      0.0063905306,
      -0.017543169,
      0.031993706,
      -0.010509481,
      -0.031637914,
      -0.017009486,
      0.0076084263,
      -0.020498961,
      -0.014313694,
      0.021840014,
      0.005241056,
      -0.0075126365,
      0.043762133,
      0.0041428977,
      -0.006212636,
      -0.0005003293,
      0.006246846,
      0.00035942456,
      -0.0068250047,
      -0.021525277,
      0.0032414496,
      0.019582119,
      -0.0032807917,
      0.009544743,
      -0.015463168,
      -0.0046389503,
      0.010735271,
      0.032376863,
      -0.029393703,
      0.008833163,
      0.004868161,
      0.009900533,
      -0.0009476322,
      -0.006294741,
      -0.0013333561,
      0.010755797,
      -0.0036673709,
      0.012213166,
      -0.0073757945,
      -0.0064315833,
      0.012384219,
      -0.016913695,
      -0.023851594,
      -0.0045978976,
      0.02130633,
      0.018405275,
      0.015134747,
      0.03259581,
      -0.014053693,
      -0.024262121,
      0.0070884256,
      0.02374212,
      -0.016612643,
      0.012993166,
      0.0059492146,
      -0.03664634,
      0.0008685203,
      -0.00008825253,
      0.009818427,
      -0.0056960564,
      0.0385895,
      -0.007909479,
      -0.021415804,
      0.013971589,
      0.024043174,
      -0.027929492,
      -0.018993696,
      -0.0024888173,
      -0.0241937,
      -0.010488954,
      -0.011912113,
      -0.01874738,
      0.0093668485,
      0.022209488,
      0.016886327,
      0.007820532,
      0.019376855,
      -0.011542639,
      0.0045123715,
      -0.0008321716,
      -0.008805796,
      -0.0007624676,
      0.011515271,
      0.007991584,
      -0.038808446,
      0.0000684211,
      -0.012760535,
      -0.0009219743,
      0.017474748,
      -0.006151057,
      0.025726333,
      0.026944228,
      0.031966336,
      -0.04083371,
      0.014806326,
      -0.041107394,
      -0.030050546,
      -0.025247386,
      -0.0024169753,
      -0.031802125,
      0.0016224353,
      -0.035852656,
      -0.0029403968,
      -0.019910539,
      -0.032842126,
      0.010016848,
      -0.014546325,
      -0.017064221,
      -0.0247137,
      0.012637377,
      0.005353951,
      0.0062092147,
      -0.01638001,
      -0.0018182907,
      -0.011357903,
      -0.0022082909,
      0.013212114,
      -0.0003301318,
      -0.022058962,
      0.008689479,
      -0.012220008,
      -0.0043994766,
      0.010564217,
      0.022661068,
      0.0025606595,
      -0.022195805,
      0.0043926346,
      0.019595802,
      0.0014778957,
      0.025917912,
      0.005093951,
      -0.005942372,
      0.0050836876,
      -0.017625274,
      0.0048852665,
      -0.008018953,
      0.0014847378,
      -0.014518957,
      -0.030898968,
      -0.020088434,
      0.017543169,
      0.009455795,
      0.013636325,
      0.00070687546,
      -0.013868957,
      0.010495797,
      0.0035065813,
      -0.018651592,
      -0.026780017,
      -0.012589482,
      0.007793163,
      0.027710544,
      -0.021881066,
      0.0046457923,
      -0.015517905,
      0.006400794,
      0.008764743,
      -0.0042523714,
      0.036181077,
      -0.0038350024,
      0.014108431,
      -0.035086337,
      0.0037871078,
      -0.012185797,
      0.039821077,
      -0.001057106,
      0.0064315833,
      -0.049701087,
      -0.025261069,
      -0.009797901,
      0.012315798,
      0.025329491,
      0.03678318,
      0.013998956,
      -0.0055831615,
      -0.0055147405,
      0.014231589,
      0.0032192126,
      -0.0071431627,
      -0.005117898,
      -0.049701087,
      0.020704225,
      0.00272487,
      0.031364232,
      -0.019541066,
      -0.004047108,
      -0.0037015814,
      -0.005408688,
      -0.0040778974,
      0.0060176356,
      0.029311597,
      -0.0065102675,
      -0.007909479,
      -0.007615268,
      0.027286334,
      0.0012786193,
      0.024056857,
      0.025698964,
      -0.003261976,
      -0.015230536,
      -0.02017054,
      0.007238952,
      0.0082379,
      -0.010297375,
      0.0001771465,
      -0.012835798,
      -0.022948436,
      0.008928954,
      -0.020745277,
      -0.0063357935,
      -0.0056960564,
      -0.005812372,
      -0.009763691,
      0.02542528,
      -0.007670005,
      0.028244229,
      -0.0008646716,
      -0.0151758,
      0.026780017,
      -0.006359741,
      -0.027163176,
      -0.019691592,
      0.016421063,
      -0.006233162,
      -0.008627901,
      0.0055078985,
      0.014874747,
      -0.011960008,
      0.017365275,
      -0.002348554,
      0.005607109,
      -0.0064931624,
      0.0043139504,
      -0.015162115,
      -0.00097414537,
      0.007813689,
      -0.011713692,
      -0.029366335,
      0.00003968958,
      0.002837765,
      -0.011173165,
      -0.019240012,
      -0.02610949,
      -0.010133165,
      -0.01401264,
      0.01841896,
      0.017324222,
      0.0035647391,
      -0.0010177639,
      -0.007498952,
      -0.025151595,
      -0.0027847388,
      0.017201064,
      -0.024262121,
      0.01508001,
      -0.03440213,
      -0.005802109,
      -0.008990532,
      -0.0021518436,
      -0.040122133,
      0.008525269,
      0.046964243,
      -0.038616866,
      -0.0018285539,
      0.010495797,
      -0.009585796,
      -0.014833694,
      -0.0021227645,
      0.007300531,
      -0.024836859,
      -0.005172635,
      -0.008586848,
      -0.030816862,
      0.016503168,
      0.023441069,
      0.0063905306,
      0.009893691,
      -0.017926328,
      -0.013862114,
      0.0057713194,
      0.1003327,
      0.021511594,
      0.008354216,
      0.01232264,
      0.0034877656,
      -0.014217904,
      -0.00505974,
      -0.0065684253,
      0.014300009,
      0.020676855,
      -0.024891594,
      -0.022743173,
      0.014135798,
      0.0175158,
      0.017789485,
      0.0070610573,
      0.00794369,
      -0.010112639,
      0.03453897,
      -0.005761056,
      -0.022647383,
      0.005908162,
      0.018049486,
      0.013951062,
      -0.001994475,
      -0.023783173,
      0.005542109,
      0.008320006,
      -0.009421585,
      -0.020197907,
      -0.0068147415,
      0.018364223,
      0.014573694,
      -0.016106326,
      -0.031856865,
      0.0032021073,
      0.015723169,
      0.021922119,
      0.020444224,
      0.0175158,
      0.0028702652,
      0.008244743,
      0.010044217,
      0.0011879613,
      0.011275797,
      -0.00061151356,
      -0.0051350035,
      0.011460534,
      0.014737904,
      -0.010646323,
      0.014409483,
      0.004040266,
      -0.003862371,
      -0.014149483,
      0.010762638,
      -0.001465922,
      0.019869486,
      0.018022116,
      -0.012733166,
      0.009667901,
      0.0007800005,
      -0.01839159,
      -0.0062160566,
      -0.0072184256,
      0.0027009228,
      -0.028298967,
      0.0005191451,
      0.0020680276,
      -0.027587386,
      -0.009962112,
      -0.011186849,
      0.0103384275,
      -0.0005879938,
      0.009982638,
      0.02928423,
      0.01161106,
      0.009784217,
      0.016393695,
      0.019349486,
      0.021525277,
      0.012664746,
      0.0046150032,
      -0.006332373,
      -0.01770738,
      -0.004177108,
      0.018884223,
      0.0038213183,
      0.013506325,
      0.0075742155,
      0.035360023,
      0.021963172,
      -0.019089486,
      0.016188432,
      0.007498952,
      -0.013307904,
      0.013390008,
      0.0061544776,
      0.0042728977,
      0.002124475,
      -0.014382115,
      -0.0023126332,
      -0.02565791,
      -0.009127375,
      -0.0095036905,
      0.021812646,
      0.013526851,
      -0.006859215,
      -0.010064743,
      -0.0063802674,
      0.008135268,
      0.01375264,
      -0.0033971076,
      0.005798688,
      0.016817905,
      -0.034347393,
      0.008648427,
      -0.013793693,
      0.051233716,
      0.00972948,
      -0.019089486,
      -0.005487372,
      -0.019582119,
      0.025178963,
      0.01884317,
      0.004420003,
      0.01131685,
      -0.03311581,
      -0.016817905,
      0.017844222,
      -0.011823165,
      0.0033132916,
      0.017009486,
      -0.013875798,
      -0.015723169,
      0.0019157907,
      0.0021843435,
      -0.016598959,
      -0.007875268,
      -0.02277054,
      0.014601062,
      -0.02253791,
      0.023618963,
      0.014970536,
      -0.015654746,
      -0.020608434,
      -0.028435808,
      -0.006807899,
      -0.012534745,
      -0.0069413204,
      0.022838963,
      -0.002283554,
      0.009483164,
      -0.013540535,
      -0.0048305294,
      -0.01929475,
      -0.003684476,
      -0.026068438,
      -0.0329516,
      -0.011063691,
      0.014505273,
      0.011761587,
      0.0013342114,
      0.025480017,
      -0.0061305305,
      -0.009763691,
      0.014026325,
      0.004101845,
      0.00038828974,
      -0.024221068,
      0.032677915,
      0.0013675666,
      0.020252645,
      -0.013020535,
      -0.01420422,
      -0.030734757,
      0.03467581,
      -0.015230536,
      -0.008798953,
      -0.015285273,
      -0.0063802674,
      -0.0010853297,
      0.026971597,
      -0.024111595,
      -0.0002054771,
      -0.01728317,
      0.0011298034,
      0.029722124,
      0.005658425,
      0.012404745,
      0.0059047407,
      0.037795816,
      -0.025206333,
      0.021196855,
      -0.011453692,
      0.0061886883,
      0.013499483,
      -0.0014342773,
      -0.04488424,
      0.012165271,
      0.011590534,
      -0.0082721105,
      -0.0071978993,
      0.0038178973,
      0.0035886865,
      0.0043036873,
      0.010181059,
      -0.008710005,
      -0.02017054,
      -0.02121054,
      0.0015394747,
      -0.022496857,
      0.0036023709,
      -0.0028702652,
      -0.011939482,
      -0.007498952,
      0.0138484305,
      -0.011925797,
      -0.0004498687,
      -0.038096868,
      -0.020280013,
      0.0042694765,
      -0.014546325,
      0.021196855,
      0.022223173,
      0.012220008,
      0.0000017389249,
      0.004933161,
      -0.026177911,
      0.010297375,
      0.007471584,
      -0.005921846,
      0.012473166,
      0.015996853,
      -0.025220016,
      -0.020403171,
      0.012568955,
      0.011700008,
      -0.023263173,
      -0.0077589527,
      0.023701068,
      -0.01196685,
      0.00894948,
      -0.02007475,
      0.0075194784,
      -0.01718738,
      0.008374742,
      -0.034949496,
      0.007861584,
      -0.0016318432,
      -0.007930005,
      -0.010324744,
      0.015121062,
      -0.038808446,
      0.027327387,
      0.0034261865,
      0.00011995074,
      0.018282117,
      -0.014081062,
      -0.0052821087,
      0.0007551979,
      0.014477904,
      0.015025273,
      -0.012014745,
      0.023263173,
      0.015846327,
      -0.0022903963,
      0.010509481,
      0.005928688,
      0.033936866,
      0.027806334,
      -0.012986325,
      -0.019636855,
      0.005241056,
      -0.006496583,
      -0.0032961864,
      -0.009168427,
      -0.006913952,
      -0.017023169,
      -0.007841058,
      -0.017597906,
      0.0023126332,
      -0.005613951,
      0.0013222377,
      0.005812372,
      0.00635632,
      -0.03366318,
      -0.02208633,
      0.005347109,
      0.008833163,
      0.0018610539,
      -0.028162124,
      -0.01420422,
      0.003265397,
      0.016489485,
      0.0048476346,
      0.010057901,
      -0.01858317,
      0.012630534,
      0.0046252664,
      -0.0070200046,
      0.004481582,
      0.024864227,
      -0.026068438,
      -0.002685528,
      -0.012480008,
      -0.0105368495,
      0.025274754,
      -0.013239482,
      -0.0058773723,
      0.0036263182,
      0.017146327,
      0.017255802,
      0.010933692,
      -0.0041463184,
      0.021511594,
      -0.004919477,
      0.0006350333,
      0.012459482,
      -0.029530546,
      0.014778957,
      0.009455795,
      -0.029366335,
      0.015216853,
      -0.026862122,
      0.016790537,
      0.012151587,
      -0.026971597,
      0.008148952,
      -0.023687383,
      0.0012965798,
      0.011549481,
      0.008354216,
      -0.035168443,
      -0.021155803,
      -0.025384227,
      -0.016530538,
      -0.019253697,
      -0.0016403958,
      0.012801588,
      -0.0011203955,
      -0.011029481,
      0.024960017,
      0.01825475,
      0.0014248694,
      -0.021580014,
      0.015914747,
      -0.0040778974,
      -0.008121585,
      -0.02558949,
      -0.015764222,
      -0.026738966,
      0.040395815,
      0.008874216,
      -0.012698956,
      -0.013383167,
      0.009100006,
      -0.052136876,
      -0.007300531,
      0.00972948,
      0.018336855,
      0.022674752,
      -0.00008253295,
      -0.008935795,
      0.015969485,
      0.0017276327,
      0.024344226,
      -0.024371594,
      -0.0015788168,
      0.009147901,
      -0.016708432,
      0.00072697416,
      0.000638882,
      -0.0008441453,
      0.000010383436,
      0.020348435,
      0.019376855,
      -0.0014188825,
      0.025178963,
      -0.009093164,
      -0.02279791,
      -0.015312642,
      0.0008817769,
      0.014067378,
      -0.008148952,
      0.008347373,
      -0.027409492,
      0.014409483,
      -0.020061066,
      -0.0045226347,
      -0.020731593,
      -0.009414743,
      0.005104214,
      -0.002960923,
      0.0049571083,
      0.009681585,
      -0.01063948,
      0.03120002,
      -0.0075879,
      0.035551604,
      -0.011679482,
      -0.022031594,
      -0.004177108,
      0.009353164,
      0.0025982913,
      0.00046526347,
      0.011816324,
      -0.023071595,
      0.021347383,
      -0.01138527,
      -0.019157907,
      -0.016694747,
      -0.027026333,
      0.005087109,
      -0.014628431,
      0.0023143436,
      -0.0066300044,
      -0.01037948,
      -0.011693166,
      0.002493949,
      0.059115827,
      -0.013513166,
      0.013513166,
      -0.027053703,
      -0.011063691,
      -0.006373425,
      -0.008005269,
      -0.0049023717,
      -0.017433695,
      0.013034219,
      0.0068900045,
      -0.023235805,
      -0.00794369,
      -0.011097902,
      0.001997896,
      -0.017981064,
      0.012514219,
      0.20646751,
      0.012986325,
      -0.024234753,
      0.016393695,
      -0.0020577644,
      0.018829485,
      0.008545795,
      0.026000017,
      -0.016421063,
      -0.00025251662,
      -0.023837911,
      -0.002863423,
      -0.022784226,
      -0.001712238,
      -0.0021740803,
      -0.053040035,
      -0.034922127,
      -0.036591604,
      0.0055865827,
      -0.015162115,
      0.011310007,
      -0.00039021406,
      0.0011768428,
      -0.008881059,
      0.0072800047,
      0.024563175,
      -0.010530007,
      -0.010242638,
      0.026369492,
      0.015490537,
      -0.007601584,
      -0.015764222,
      -0.03016002,
      0.006783952,
      0.016352642,
      0.00937369,
      0.032568444,
      -0.010666849,
      0.024248436,
      0.025534753,
      0.014258957,
      0.026930545,
      -0.02260633,
      0.005548951,
      0.013629483,
      0.011104744,
      -0.017953696,
      0.013123167,
      0.013971589,
      0.010482112,
      -0.051507402,
      0.013027377,
      0.030378968,
      0.027382122,
      0.013478956,
      -0.01319843,
      0.007177373,
      0.043214764,
      -0.007991584,
      0.001199935,
      -0.016051589,
      0.030378968,
      -0.0000717887,
      -0.017556854,
      -0.0009356585,
      0.0045089503,
      -0.007601584,
      -0.0047723716,
      0.030242125,
      -0.0048476346,
      0.030242125,
      0.00008798525,
      0.009866322,
      0.0022134224,
      -0.0048271082,
      -0.030050546,
      0.03292423,
      -0.011939482,
      0.056762144,
      0.040067393,
      0.001864475,
      -0.021429488,
      -0.0015497379,
      -0.000012240962,
      0.018870538,
      -0.029147388,
      0.029557914,
      0.0127400085,
      -0.013465272,
      -0.012822114,
      0.0026632913,
      -0.019048434,
      0.005798688,
      -0.021716855,
      0.0035750023,
      0.024932647,
      0.0027590808,
      0.010235796,
      -0.0014539483,
      0.015257905,
      -0.009154743,
      0.018884223,
      -0.011481061,
      -0.01349264,
      -0.027300019,
      0.01209685,
      0.012404745,
      0.014272641,
      0.010352112,
      0.003732371,
      0.002240791,
      -0.014833694,
      0.0007971058,
      -0.0065273726,
      0.00032457258,
      0.01122106,
      0.03161055,
      0.0015882248,
      0.00859369,
      0.004430266,
      0.005624214,
      -0.020608434,
      -0.009982638,
      -0.0002937831,
      0.011097902,
      -0.002960923,
      -0.018692644,
      0.0094421115,
      -0.0023263174,
      -0.02802528,
      0.02270212,
      0.0031439494,
      0.014081062,
      0.0021586856,
      -0.031117916,
      0.012986325,
      0.01683159,
      -0.026875807,
      -0.016503168,
      -0.0008980269,
      0.0068831625,
      -0.0013581588,
      -0.021511594,
      0.012083166,
      -0.0064076358,
      0.008039479,
      -0.0055694776,
      -0.0029523703,
      -0.015038957,
      -0.02208633,
      -0.0013256588,
      -0.018309485,
      -0.018761065,
      -0.0221137,
      0.007724742,
      -0.007916321,
      -0.030105283,
      0.0007423689,
      0.021840014,
      -0.008901585,
      -0.009318953,
      -0.016010538,
      0.0056413193,
      0.011734218,
      -0.011741061,
      0.0017481591,
      -0.17614327,
      0.02490528,
      0.016516853,
      -0.009175269,
      0.012445797,
      -0.009626849,
      0.017926328,
      0.02312633,
      -0.02069054,
      0.0010562507,
      0.03070739,
      -0.0008591124,
      -0.042037923,
      -0.023208436,
      -0.017625274,
      -0.005624214,
      -0.03314318,
      0.0043550027,
      0.029886335,
      0.007786321,
      0.03396423,
      -0.032513704,
      0.010776323,
      -0.0024682912,
      -0.013786851,
      0.0060244775,
      0.011111586,
      -0.004180529,
      0.00541553,
      0.0054121087,
      -0.017214749,
      -0.016366327,
      0.016845275,
      -0.012042114,
      0.018104222,
      0.0042078975,
      0.00920948,
      -0.01692738,
      -0.002215133,
      0.029037913,
      0.011953166,
      -0.002971186,
      -0.010769481,
      0.010003164,
      0.006342636,
      0.011029481,
      0.0058157933,
      -0.027122123,
      0.01981475,
      -0.0005721714,
      0.019636855,
      -0.018022116,
      0.012911061,
      -0.00008948197,
      -0.007724742,
      0.021976857,
      -0.0064589516,
      0.002338291,
      0.013246325,
      0.00301566,
      -0.0017387512,
      -0.024946332,
      -0.024412647,
      0.0004026154,
      0.013629483,
      -0.012124218,
      -0.009195795,
      0.017789485,
      -0.02023896,
      0.014874747,
      0.0002886515,
      -0.0254937,
      0.0039068446,
      -0.02218212,
      0.014108431,
      0.018555801,
      -0.0033936864,
      -0.01579159,
      0.016749484,
      0.005487372,
      -0.0020714488,
      0.024152648,
      -0.019595802,
      -0.006212636,
      -0.007067899,
      0.009674743,
      0.001063948,
      0.01157685,
      -0.011816324,
      0.00937369,
      0.019636855,
      -0.022058962,
      -0.021320013,
      0.011446849,
      0.028490545,
      0.029120019,
      -0.0033252654,
      0.017885275,
      -0.02156633,
      -0.017693697,
      0.00027261532,
      -0.004748424,
      -0.00898369,
      0.012698956,
      0.044117924,
      0.036126338,
      0.01884317,
      0.013410535,
      0.02078633,
      -0.00021178467,
      -0.015723169,
      0.009544743,
      0.023687383,
      0.027300019,
      -0.016393695,
      0.022236858,
      0.021648435,
      -0.013766325,
      0.023536857,
      0.009332637,
      0.023358963,
      -0.01919896,
      -0.010495797,
      0.015531589,
      -0.0014240141,
      -0.023208436,
      -0.09589901,
      -0.033280022,
      0.021963172,
      0.0055934247,
      0.010358954,
      0.02996844,
      -0.0074579,
      -0.010222112,
      -0.000346168,
      0.015121062,
      -0.00956527,
      -0.015408431,
      0.017105274,
      -0.0068386886,
      0.034484234,
      -0.008532111,
      0.004495266,
      0.018542118,
      -0.045623187,
      0.0045910557,
      -0.018624222,
      0.001031448,
      0.013841588,
      0.010140006,
      -0.006359741,
      -0.01209685,
      -0.025192648,
      0.020567382,
      0.011556324,
      0.022291593,
      -0.015449484,
      0.0010177639,
      0.009147901,
      -0.021908436,
      0.030050546,
      -0.015148431,
      0.0069857943,
      -0.0047518453,
      0.0151758,
      0.0000066082484,
      -0.009517374,
      -0.007868426,
      0.02069054,
      -0.03070739,
      0.008751058,
      -0.008176321,
      -0.031692654,
      0.012664746,
      -0.004861319,
      -0.012630534,
      -0.020567382,
      -0.017597906,
      -0.014833694,
      -0.014149483,
      0.02805265,
      0.011036323,
      -0.013547378,
      -0.0017267774,
      -0.026547385,
      -0.009736322,
      0.0013487509,
      -0.007485268,
      0.008997374,
      0.0036981604,
      0.011939482,
      0.0011930929,
      -0.01271264,
      0.011029481,
      0.01138527,
      -0.015996853,
      0.002769344,
      -0.011289481,
      -0.00492974,
      -0.025247386,
      -0.026260016,
      -0.009161585,
      0.0009869743,
      0.010092112,
      0.011193692,
      -0.0017943432,
      -0.010653165,
      -0.00956527,
      0.007533163,
      -0.023796858,
      0.009941585,
      0.028654756,
      0.028791597,
      0.010064743,
      0.0055934247,
      -0.0350316,
      0.017762117,
      0.014710536,
      0.01323264,
      -0.009955269,
      -0.004177108,
      0.008812637,
      0.0049365824,
      -0.0059594777,
      -0.015134747,
      0.02698528,
      -0.03525055,
      -0.022318963,
      -0.07482531,
      0.0040881606,
      0.018200012,
      -0.011193692,
      -0.0068831625,
      0.006113425,
      0.0044063185,
      0.0020680276,
      0.02513791,
      0.000904869,
      -0.017529486,
      -0.016694747,
      0.012035271,
      0.015750537,
      -0.02805265,
      -0.008867375,
      0.0026581597,
      0.01780317,
      0.02402949,
      0.00898369,
      -0.016913695,
      0.0054565826,
      0.00052513194,
      -0.004741582,
      -0.020115802,
      0.0017567116,
      -0.03352634,
      0.007820532,
      -0.018514749,
      -0.01297264,
      0.007156847,
      -0.019582119,
      -0.011501586,
      0.03505897,
      -0.0077726366,
      -0.040560026,
      -0.0062707937,
      0.03683792,
      0.016804222,
      0.045021083,
      -0.031802125,
      -0.015969485,
      0.023660015,
      -0.03259581,
      0.004532898,
      0.010140006,
      0.010790007,
      0.01005106,
      0.024180016,
      0.00079454,
      -0.019842118,
      0.01841896,
      -0.015298957,
      -0.018706327,
      -0.010810534,
      -0.020047382,
      -0.026013702,
      0.004786056,
      -0.007040531,
      -0.019965276,
      0.059115827,
      0.008970005,
      0.020444224,
      0.006729215,
      0.0058294777,
      -0.038863182,
      -0.021402119,
      0.0126031665,
      0.012671587,
      -0.01086527,
      -0.031966336,
      0.0065855305,
      0.0036571077,
      0.0076494785,
      -0.0043892134,
      -0.039574765,
      0.004235266,
      -0.025726333,
      -0.0006080925,
      0.0313916,
      0.007047373,
      0.010742112,
      -0.02490528,
      0.023071595,
      0.013253166,
      -0.018022116,
      0.008662111,
      -0.0016489484,
      -0.02610949,
      0.0149568515,
      -0.026082123,
      0.024111595,
      -0.0006538491,
      -0.032185283,
      0.0057678986,
      -0.02298949,
      0.0053950036,
      -0.02218212,
      0.012781061,
      0.014601062,
      -0.0013607246,
      0.014300009,
      -0.0030071072,
      -0.028162124,
      -0.021402119,
      0.0005353951,
      -0.047237925,
      -0.034292653,
      0.019445276,
      0.01005106,
      -0.016954748,
      0.018336855,
      0.009086322,
      -0.001871317,
      -0.0036434236,
      -0.01508001,
      0.036920026,
      -0.005227372,
      -0.024234753,
      0.027026333,
      0.023386331,
      0.014272641,
      0.018008433,
      -0.0025384228,
      0.0120557975,
      -0.0215937,
      -0.010728428,
      -0.023947384,
      0.019623172,
      0.0074510574,
      0.011289481,
      0.0029386862,
      -0.038972657,
      -0.015531589,
      -0.021621067,
      0.010064743,
      0.011802639,
      0.0019123696,
      -0.005812372,
      0.06935162,
      0.008135268,
      0.0013692772,
      0.021237908,
      -0.013930536,
      0.030077914,
      0.003482634,
      0.013773167,
      -0.013916851,
      -0.009134216,
      0.034347393,
      0.006975531,
      0.001462501,
      -0.009702112,
      -0.023920016,
      0.009093164,
      -0.044254765,
      0.0032551337,
      -0.010564217,
      -0.0050665825,
      0.032212652,
      -0.01955475,
      -0.0006872044,
      0.012103693,
      -0.00424895,
      0.007170531,
      0.018309485,
      0.023769489,
      -0.015134747,
      -0.012035271,
      -0.00460474,
      0.016147379,
      -0.041435815,
      -0.005312898,
      -0.016954748,
      -0.0056447405,
      0.0013034219,
      -0.024275806,
      0.0128152715,
      0.010365796,
      -0.00032328969,
      0.01157685,
      -0.015476853,
      -0.03856213,
      -0.031829495,
      -0.0030772388,
      -0.011768429,
      -0.012651061,
      -0.02357791,
    ];
    //await generateEmbeddings(chunkedReviews[i].content);

    await insertActivityEmbedding({
      content: chunkedReviews[i].content,
      content_tokens: chunkedReviews[i].content_tokens,
      embedding,
      activity_id: activity.id,
    });

    await new Promise(res => setTimeout(res, 500));
  }
};
